@model Scheduler.ViewModels.Test
@{
    ViewData["Title"] = "Home Page";
    var ci = new System.Globalization.CultureInfo("en-US");
}

<ul class="doctors">

    @foreach (var doctor in Model.Doctors)
    {
        <li>
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#@doctor.Id">
                                <div class="image">
                                    <td><img width="64px" height="64px" src="/Home/ViewImage/@doctor.Id" /></td>
                                </div>
                                <div class="details">
                                    <div class="Name" style="font-size:20px"><strong>@doctor.Name @doctor.Surname</strong></div>
                                    <div class="Scope">@doctor.Scope</div>
                                </div>
                            </a>
                        </h4>
                    </div>
                    <div id="@doctor.Id" class="panel-collapse collapse">
                        <div class="panel-body">
                            <div>Address: @doctor.Address - @doctor.Office</div>
                            <div>Phone: @doctor.PhoneNumber</div>

                            <br />

                            <div class="form-group">
                                <label>Select day:</label>
                                <select name="selectDay" id="selectDay-@doctor.Id" class="form-control" onchange="myFunction(@doctor.Id)">

                                    <option disabled selected value="">-- select day --</option>

                                    @for (int j = 0; j < DateTime.DaysInMonth(DateTime.Now.Year, DateTime.Now.Month) - DateTime.Now.Day; j++)
                                    {
                                        @if ((DateTime.Now.AddDays(j).ToString("ddd", ci) == "Mon" && doctor.DoctorWorkHours.MondayFrom != null) ||
                                           (DateTime.Now.AddDays(j).ToString("ddd", ci) == "Tue" && doctor.DoctorWorkHours.TuesdayFrom != null) ||
                                           (DateTime.Now.AddDays(j).ToString("ddd", ci) == "Wed" && doctor.DoctorWorkHours.WednesdayFrom != null) ||
                                           (DateTime.Now.AddDays(j).ToString("ddd", ci) == "Thu" && doctor.DoctorWorkHours.ThursdayFrom != null) ||
                                           (DateTime.Now.AddDays(j).ToString("ddd", ci) == "Fri" && doctor.DoctorWorkHours.FridayFrom != null) ||
                                           (DateTime.Now.AddDays(j).ToString("ddd", ci) == "Sat" && doctor.DoctorWorkHours.SaturdayFrom != null) ||
                                           (DateTime.Now.AddDays(j).ToString("ddd", ci) == "Sun" && doctor.DoctorWorkHours.SundayFrom != null))
                                        {
                                            <option value="@DateTime.Now.AddDays(j).DayOfWeek.ToString("d")">
                                                @DateTime.Now.AddDays(j).DayOfWeek ( @DateTime.Now.AddDays(j).ToString("MM/dd") )
                                            </option>
                                        }

                                    }
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Select time:</label>
                                <select id="selectTime-@doctor.Id" class="form-control">
                                    <option disabled selected value="">-- select one --</option>
                                </select>
                            </div>

                            <button class="btn btn-default">Register</button>
                        </div>
                    </div>
                </div>
            </div>
        </li>
    }

</ul>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    function myFunction(doctorId) {

        $("#selectTime-" + doctorId).html("");

        $.getJSON("/Home/GetJson/", { DayId: $("#selectDay-" + doctorId).val(), doctorId: doctorId }, function (data) {

            for (var obj in data) {
                console.log(data[obj].text);
                $("#selectTime-" + doctorId).append("<option value='2'>" + data[obj].text + "</option>");
            }
        });
    }
</script>



